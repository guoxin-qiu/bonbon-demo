var I=(S,t,s)=>new Promise((u,f)=>{var y=r=>{try{i(s.next(r))}catch(e){f(e)}},p=r=>{try{i(s.throw(r))}catch(e){f(e)}},i=r=>r.done?u(r.value):Promise.resolve(r.value).then(y,p);i((s=s.apply(S,t)).next())});import{m as q,n as B,o as $,p as K,q as D,b as T}from"./element-plus-c89972e5.js";import{d as z,p as L,n as F,o as P,b as R,e as h,aD as N,aC as O,t as x,O as l,T as b,u as a,Y as U,an as W,a0 as j,X as A}from"./vendor0-9e9963e5.js";import{u as J,W as Q,_ as X,w as Y,a as Z}from"./index-3da9c86c.js";import"./vendor1-b25ebc05.js";import"./graphql-9dc7dd56.js";const G={class:"s-canvas",style:{cursor:"pointer"}},ee=["width","height"],te=z({__name:"index",props:{identifyCode:{default:""},fontSizeMin:{default:35},fontSizeMax:{default:38},backgroundColorMin:{default:180},backgroundColorMax:{default:240},colorMin:{default:50},colorMax:{default:160},lineColorMin:{default:100},lineColorMax:{default:200},dotColorMin:{default:0},dotColorMax:{default:255},contentWidth:{default:120},contentHeight:{default:40}},setup(S){const t=S;function s(e,o){return Math.floor(Math.random()*(o-e)+e)}function u(e,o){const d=s(e,o),v=s(e,o),_=s(e,o);return`rgb(${d},${v},${_})`}function f(){return"rgb(255,255,255)"}function y(e,o,d){e.fillStyle=u(t.colorMin,t.colorMax),e.font=s(t.fontSizeMin,t.fontSizeMax)+"px SimHei";const v=(d+1)*(t.contentWidth/(t.identifyCode.length+1)),_=s(t.fontSizeMax,t.contentHeight-5),C=s(-10,10);e.translate(v,_),e.rotate(C*Math.PI/180),e.fillText(o,0,0),e.rotate(-C*Math.PI/180),e.translate(-v,-_)}function p(e){for(let o=0;o<8;o++)e.strokeStyle=u(t.lineColorMin,t.lineColorMax),e.beginPath(),e.moveTo(s(0,t.contentWidth),s(0,t.contentHeight)),e.lineTo(s(0,t.contentWidth),s(0,t.contentHeight)),e.stroke()}function i(e){for(let o=0;o<100;o++)e.fillStyle=u(0,255),e.beginPath(),e.arc(s(0,t.contentWidth),s(0,t.contentHeight),1,0,2*Math.PI),e.fill()}function r(){const o=document.getElementById("s-canvas").getContext("2d");o.textBaseline="bottom",o.fillStyle=u(t.backgroundColorMin,t.backgroundColorMax),o.fillStyle=f(),o.fillRect(0,0,t.contentWidth,t.contentHeight);for(let d=0;d<t.identifyCode.length;d++)y(o,t.identifyCode[d],d);p(o),i(o)}return L(r),F(()=>t.identifyCode,r),(e,o)=>(P(),R("div",G,[h("canvas",{id:"s-canvas",width:t.contentWidth,height:t.contentHeight},null,8,ee)]))}}),oe={class:"login-container"},ne={class:"flex text-white items-center py-4 title-wrap"},se={class:"text-2xl flex-1 text-center title"},ae={class:"p-2 text-white"},le={class:"p-2 text-white"},re={class:"p-2 text-white"},ie=["data-v-code"],de=z({__name:"index",setup(S){const t=N(),s=O(),u=J(),f=x(!1),y=x(!1),p=x(!1),i=x(""),r=x(),e=x({username:"",password:"",verifyCode:""}),o={username:[{required:!0,trigger:"blur",message:"用户名不能为空"}],password:[{required:!0,trigger:"blur",validator:d}],verifyCode:[{required:!0,trigger:"blur",message:"验证码不能为空"}]};function d(m,n,c){n.length<3?c(new Error("密码不能少于3个字符")):c()}function v(m){const{key:n}=m;y.value=n&&n.length===1&&n>="A"&&n<="Z"}function _(){i.value="";const m="23456789abcdwerwshdjeJKDHRJHKPLMKQ";for(let n=0;n<4;n++)i.value+=m[Math.floor(Math.random()*m.length)]}function C(){r.value.validate(m=>I(this,null,function*(){var n,c;if(m){if(i.value.toLowerCase()!==((n=e.value.verifyCode)==null?void 0:n.toLowerCase())){T({message:"验证码错误",type:"error"});return}f.value=!0;const w=yield u.login(e.value);if(f.value=!1,w.success){T({message:"登录成功",type:"success"}),yield Y(100);const g=s.query,E=(c=g.redirect)!=null?c:"/",H=Object.keys(g).reduce((V,k)=>(k!=="redirect"&&(V[k]=g[k]),V),{});t.push({path:E,query:H})}else T({message:w.message,type:"error"}),_()}}))}return L(()=>{_()}),(m,n)=>{const c=X,w=B,g=$,E=K,H=te,V=D,k=q;return P(),R("div",oe,[l(k,{ref_key:"loginFormRef",ref:r,model:a(e),rules:o,class:"login-form"},{default:b(()=>[h("div",ne,[h("span",se,U(a(Q)),1)]),l(g,{prop:"username"},{default:b(()=>[h("div",ae,[l(c,{"icon-class":"user"})]),l(w,{ref:"username",modelValue:a(e).username,"onUpdate:modelValue":n[0]||(n[0]=M=>a(e).username=M),class:"flex-1",size:"large",placeholder:"用户名",name:"username"},null,8,["modelValue"])]),_:1}),l(E,{disabled:a(y)===!1,content:"Caps lock is On",placement:"right"},{default:b(()=>[l(g,{prop:"password"},{default:b(()=>[h("span",le,[l(c,{"icon-class":"password"})]),l(w,{modelValue:a(e).password,"onUpdate:modelValue":n[1]||(n[1]=M=>a(e).password=M),class:"flex-1",placeholder:"密码",type:a(p)===!1?"password":"input",size:"large",name:"password",onKeyup:[v,W(C,["enter"])]},null,8,["modelValue","type"]),h("span",{class:"mr-2",onClick:n[2]||(n[2]=M=>p.value=!a(p))},[l(c,{"icon-class":a(p)===!1?"eye":"eye-open",class:"text-white cursor-pointer"},null,8,["icon-class"])])]),_:1})]),_:1},8,["disabled"]),l(g,{prop:"verifyCode"},{default:b(()=>[h("span",re,[l(c,{"icon-class":"verify_code"})]),l(w,{modelValue:a(e).verifyCode,"onUpdate:modelValue":n[3]||(n[3]=M=>a(e).verifyCode=M),"auto-complete":"off",placeholder:"验证码",class:"w-[60%]",onKeyup:W(C,["enter"])},null,8,["modelValue"]),h("div",{class:"captcha",onClick:_,"data-v-code":a(i),"data-test-id":"captcha"},[l(H,{identifyCode:a(i)},null,8,["identifyCode"])],8,ie)]),_:1}),l(V,{size:"default",loading:a(f),type:"primary",class:"w-full",onClick:j(C,["prevent"])},{default:b(()=>[A(" 登录 ")]),_:1},8,["loading"])]),_:1},8,["model"])])}}});const he=Z(de,[["__scopeId","data-v-8456d178"]]);export{he as default};
